{% extends "base.html" %}

{% block headers %}
    <div class="card-header-tabs card-body" >
        <h1>
        <u>Register a Season</u>
        </h1>
    </div>

{% endblock %}

{% block page_content %}
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <div class="card-body">
        <script>
            $(document).ready(function(){
                var num = 0;
                let champ;
                let champ_scu;
                
                $( "#id_year" ).blur(function() {       
                    $.ajax({
                        url: "https://v1.formula-1.api-sports.io/rankings/teams",
                        dataType: "json",
                        data: {
                            season: $("#id_year").val(),
                                
                        },
                        headers: {
                            "x-rapidapi-key": "d5c9a1dac197da1fdb1873a7d4b49afa",
                            "x-rapidapi-host": "v1.formula-1.api-sports.io"
                                
                        },
                        success: function(data){
                            $.each(data, function(indice, elemento){
                                num = elemento.length;
                            });
                            $("#id_num_scuderias").val(num);
                            $.each(data.response, function(indice, elemento){
                                if(indice == 0){                                   
                                    $.each(elemento.team, function(indice2, elemento2){
                                        if(indice2 == "name"){   
                                            champ_scu = elemento2;
                                        }
                                    });
                                }
                                
                            });
                            $("#id_scuderia_champion").val(champ_scu);
                        }
                    });
                    $.ajax({
                        url: "https://v1.formula-1.api-sports.io/rankings/drivers",
                        dataType: "json",
                        data: {
                            season: $('#id_year').val(),
                        },
                        headers: {
                            "x-rapidapi-key": "d5c9a1dac197da1fdb1873a7d4b49afa",
                            "x-rapidapi-host": "v1.formula-1.api-sports.io"
                                
                        },
                        success: function(data){
                            $.each( data.response, function(indice,valor){
                                if(indice == 0){
                                    $.each(valor.driver, function(index,value){
                                        if(index == 'name'){
                                            champ = value;
                                        }
                                    });
                                }
                            });    
                            $("#id_world_champion").val(champ);
                        }
                    });
                });
            });
                
        </script>
        <form method="post" enctype="multipart/form-data" action="">
            {% csrf_token %}
            <table>
                {{ form.as_table }}
            </table>
            <p></p>
            <input type="submit" value="Submit"/>
        </form>
    </div>

{% endblock %}